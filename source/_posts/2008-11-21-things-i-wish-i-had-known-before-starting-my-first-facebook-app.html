---
layout: post
title: Things I wish I had known before starting my first Facebook app
published: true
tags: []
date: '2008-11-21 00:44:00'
posterous_id: 10668765
posterous_url: http://blog.srcmvn.com/things-i-wish-i-had-known-before-starting-my
posterous_slug: things-i-wish-i-had-known-before-starting-my
permalink: things-i-wish-i-had-known-before-starting-my/index.html
posterous_images: []
---
<p>I am an owner of an art gallery in Seattle. We have a pretty media rich website ( <a href="http://suite100gallery.com" title="Suite 100 Gallery" target="_blank">suite100gallery.com</a> ) and we have long talked about trying to find ways to push our content out to social networks. So, I decided to experiment with a Facebook app a few days ago.  I figured I would start simple at first. We already have the data for our current show. I wanted to push up the postcard image along with all of the artwork for the show. Display the show postcard info, list the artists, and maybe have a slideshow showing all of the artwork. Maybe a few hours worth of PHP work along with another few hours of JS max. Right?  I wish.</p>
<h3>Profile content has to be set, it cannot be updated with each page load.</h3>
<p>As it turns out, profile content is more or less static. It needs to be set and is cached. It seems obvious now, but I was confused by discussions about the canvas and iframes. Turns out the canvas has nothing to do with the profile output and you can't actually use iframes for the profile box.  ( For more information see <a href="http://wiki.developers.facebook.com/index.php/Profile.setFBML" target="_blank">profile.setFBML</a>&nbsp;documentation )  I kept thinking that there was some combination of FMBL/IFRAME or some fb:iframe tag or something I was missing. Nope. It just plain cannot happen. Seems like this should be in big bold letters somewhere.  After several hours, I finally give in and realize there is no way around it... and decide, "No problem! I'll just set things dynamically with JavaScript."</p>
<h3>Profile content JavaScript events are deferred until after the first active event ( that means no mouseover or onload! ).</h3>
<p>After more time has passed, and my JavaScript is not working, I discover all sorts of <a href="http://wiki.developers.facebook.com/index.php/FBJS" target="_blank">neat things about Facebook's JavaScript</a>. Mainly, it isn't actually JavaScript. In fact, it isn't even the JavaScript you write. They parse your code and rewrite it. Fun times trying to debug, let me tell you what. :)  The events work, but only the active ones at first. That means no timers. No onload. Nothing of that nature. Unless someone actually does something active to your content ( onclick, onfocus, etc. ) you cannot react.  So no slide show until someone clicks at least once. In fact, no randomization, either. I had thought maybe I could survive the "cache" probably by simply including all of the images in JavaScript and have it display a random one once the page loads, but with no onload like functionality that isn't possible.  So now what? In order to get the illusion of dynamic content the profile box content needs to be updated manually by profile.setFBML(). Now, this can be done quite easily when a user is on your canvas, but it isn't likely that someone is going to go to our app's canvas very frequently to get the image on their profile to update.  It occurs to me that I could probably store the session key! Cron job to the rescue! Get 1,000 users, and update each of them ever 5 minutes? Sounds like a good start, right?</p>
<h3>Profile content can be set offline but it requires storing the session key and requesting offline permissions.</h3>
<p>Surprise! The session key only lasts a certain period of time. If it expires, calls to set the profile content will fail. This requires yet another step for the user. They need to grant offline privs. This can be done somewhat easily, but there is no way to require a user does this. If your app requires offline access, I do not think there is much you can do.  So, ask for it. Hope for the best. :)  ( See <a href="http://wiki.developers.facebook.com/index.php/Fb:prompt-permission" target="_blank">fb:prompt-permission</a> documentation )  This still leaves one with the horrible idea of pushing random content to a bunch of profiles that may or may not have actually granted you offline access. Profiles that maybe only get visited once every three days! Not very efficient use of CPU cycles on your web host.</p>
<h3><a href="http://wiki.developers.facebook.com/index.php/Fb:random" target="_blank">fb:random</a> to the rescue.</h3>
<p>Hurray for <a href="http://wiki.developers.facebook.com/index.php/Fb:random" target="_blank">fb:random</a>. It is your friend. If possible, push all of your content into the profile and put them in fb:random and fb:random-option and you'll get the benefits of "dynamic" content on the page without having to push to each profile.</p>
<p><p><a href="https://gist.github.com/288246">https://gist.github.com/288246</a></p></p>
<p>This solved my problem. At least for now... I think there might be something to these <a href="http://wiki.developers.facebook.com/index.php/Fb:ref">reference handles</a>. More on that later. :)</p>
